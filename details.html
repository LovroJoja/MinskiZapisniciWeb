<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Details</title>
	<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
	
	<div class="header-title"><a class="home" id="homeButton" href="index.html"><img src="home.png" alt="Home"></a><h1>Details</h1></div>
	<button id="mapDButton"></button>
	
	
	
</header>
	<div class="container">
		<div class="content">
			<div id="details" class="details-container">
				
			</div>
		</div>
		<div class="content">
			<div id="image-container" class="image-container">
				<div id="image" class="skica"></div>
			</div>
			<button id="exportButton"></button>
		</div>
	</div>

	<script>
		const urlParams = new URLSearchParams(window.location.search);
		const id = urlParams.get('id');
		fetch(`http://localhost:3000/details?id=${id}`)
		.then(response => response.json())
		.then(data => {
			//let detailsHTML='';
			let detailsHTML = document.getElementById('details').innerHTML;
			entries = Object.entries(data);
			for(let i= 0; i< entries.length; i++){
				const [key, value] = entries[i];
				detailsHTML += `<div class="details-row"><p><strong>${key}:</strong> ${value}</p></div>`;
			}
			document.getElementById('details').innerHTML = detailsHTML;

			//LOAD IMAGE HERE
			const imageDiv = document.getElementById('image');
			const img = document.createElement('img');
			img.src = `http://localhost:3000/skice/${id}.png`;
			img.alt = `Skica image`;
			imageDiv.appendChild(img);


		}).catch(error => console.error('Error fetching details:', error));

		





		document.getElementById('exportButton').addEventListener('click', function(){

			console.log("Clicked")
			const detailsDiv = document.getElementById('details');
			const detailsJSON = {
				"@context": "http://schema.org/",
				"@type": "DeminingDocument"
			};
			detailsDiv.querySelectorAll('p').forEach(p => {
				const key = p.querySelector('strong').textContent.replace(':', '').trim();
				const value = p.textContent.replace(key + ':', '').trim();
				detailsJSON[key] = value;
			});
			const jsonData = JSON.stringify(detailsJSON, null, 2);
			const blob = new Blob([jsonData], {type:'application/ld+json'});
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = `${id}.json`;
			document.body.appendChild(a);
			a.click();
			setTimeout(() => {
				document.body.removeChild(a);
				window.URL.revokeObjectURL(url);
			}, 0);
		});
		document.getElementById('mapDButton').addEventListener('click', function() {
            window.location.href = `croGeo/osm.html?id=${id}`;
        });
	</script>
</body>
</html>